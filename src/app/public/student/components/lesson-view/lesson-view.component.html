<div class="p-6 bg-gray-100 min-h-screen" dir="rtl">
  <h2 class="text-xl font-semibold mb-4">{{ lesson.title }}</h2>
  <!-- โ ุนุฑุถ ุงููุฑูู ุฅู ูุฌุฏ -->
<div *ngIf="lesson.attachment" class="mb-6">
  <ng-container [ngSwitch]="getAttachmentType(lesson.attachment)">
    
    <!-- ๐ฅ ููุฏูู -->
    <video *ngSwitchCase="'video'" controls class="w-full max-h-[400px] rounded">
      <source [src]="lesson.attachment" type="video/mp4" />
      ุงููุชุตูุญ ูุง ูุฏุนู ุชุดุบูู ุงูููุฏูู.
    </video>

    <!-- ๐ผ๏ธ ุตูุฑุฉ -->
    <img *ngSwitchCase="'image'" [src]="lesson.attachment" class="w-full max-h-[400px] rounded shadow" />

    <!-- ๐ PDF -->
    <!-- ๐ PDF -->
    <iframe *ngSwitchCase="'pdf'" [src]="safeAttachmentUrl" class="w-full h-[500px] rounded border"></iframe>

    <!-- ๐พ ุชุญููู ูุจุงุดุฑ ูุฃู ููุน ุขุฎุฑ -->
    <div *ngSwitchDefault class="text-center mt-4">
      <a [href]="lesson.attachment" target="_blank" download class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        ุชุญููู ุงูููู
      </a>
    </div>

  </ng-container>
</div>

  <p class="text-gray-700 mb-6">{{ lesson.content }}</p>

  <!-- โ ูุชูุฌุฉ ุงูุทุงูุจ -->
  <div *ngIf="submitted" class="mb-6 text-lg text-center font-bold text-blue-800">
    ูุชูุฌุชู: {{ score }}/{{ questions.length }}
    <button (click)="retakeTest()" class="ml-4 bg-gray-500 text-white px-4 py-1 rounded hover:bg-gray-600">
      ุฅุนุงุฏุฉ ุงููุญุงููุฉ
    </button>
  </div>

  <div *ngIf="questions.length > 0">
    <h3 class="text-lg font-semibold mb-3">ุงุฎุชุจุงุฑ ูุตูุฑ</h3>

    <div *ngFor="let question of questions" class="mb-4 p-4 bg-white shadow rounded">
      <p class="font-medium mb-2">{{ question.question_text }}</p>

      <div *ngFor="let option of question.options" class="mb-1">
        <label class="flex items-center space-x-reverse space-x-2">
          <input
            type="radio"
            [name]="'question-' + question.id"
            [value]="option.id"
            [(ngModel)]="answers[question.id]"
            [disabled]="submitted"
            class="form-radio"
          />
          <span
            [ngClass]="{
              'text-green-600 font-bold': submitted && option.is_correct,
              'text-red-600 font-bold': submitted && !option.is_correct && answers[question.id] === option.id
            }"
          >
            {{ option.option_text }}
            <span *ngIf="submitted && option.is_correct">โ</span>
            <span *ngIf="submitted && !option.is_correct && answers[question.id] === option.id">โ</span>
          </span>
        </label>
      </div>
    </div>

    <button
      *ngIf="!submitted"
      (click)="submitAnswers()"
      class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
    >
      ุฅุฑุณุงู ุงูุฅุฌุงุจุงุช
    </button>
  </div>

  <div *ngIf="questions.length === 0" class="text-center text-gray-500 mt-6">
    ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ุญุงููุงู ููุฐุง ุงูุฏุฑุณ.
  </div>
</div>

