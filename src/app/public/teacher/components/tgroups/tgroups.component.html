<div *ngIf="!loading">
<div class="bg-white p-6 rounded-lg shadow-md" dir="rtl">
  <!-- ุงูุนููุงู -->
  <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
    <h2 class="text-xl font-semibold text-[#2C2F66]">ุงููุฌููุนุงุช ุงูุทูุงุจูุฉ</h2>
    <button (click)="openAddClub()"
            class="bg-[#7F55E0] text-white px-4 py-2 rounded-lg flex items-center gap-2">
      โ ุฅูุดุงุก ูุฌููุนุฉ ุฌุฏูุฏุฉ
    </button>
  </div>

  <!-- ุงูุจุญุซ -->
  <div class="mb-6">
    <input type="text" placeholder="๐ ุงูุจุญุซ ุนู ุงููุฌููุนุงุช..."
           class="p-2 w-full border rounded-lg focus:outline-[#7F55E0]"
           [(ngModel)]="searchTerm" (input)="filterClubs()" />
  </div>

  <!-- ุดุจูุฉ ุงููุฌููุนุงุช -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    <div *ngFor="let club of filteredClubs"
         class="bg-gray-100 p-4 rounded-xl shadow hover:shadow-lg transition">

      <h3 class="text-lg font-semibold text-[#2C2F66] break-words mb-1">
        {{ club.name }}
      </h3>
      <p class="text-gray-500 text-sm mb-1">๐ฅ {{ club.members_count }} ุนุถู</p>
      <p class="text-gray-500 text-sm mb-3">๐ {{ club.created_at | date }}</p>

      <div class="flex flex-wrap justify-between items-center gap-2 mt-3">
        <button class="text-blue-600 text-sm" (click)="openMembers(club)">
          ๐ฅ ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก
        </button>

        <div class="flex gap-3 text-sm">
          <button class="text-[#7F55E0]" (click)="openEditClub(club)">โ๏ธ</button>
          <button class="text-red-600" (click)="openDeleteClub(club)">๐๏ธ</button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ูุงูุฐุฉ ุฅูุดุงุก / ุชุนุฏูู -->
<div *ngIf="showClubModal"
     class="fixed inset-0 bg-black bg-opacity-30 flex justify-center items-center p-4" dir="rtl">
  <div class="bg-white p-6 rounded-lg w-full max-w-md">
    <h3 class="text-lg font-semibold mb-4">
      {{ isEditMode ? 'ุชุนุฏูู ุงููุฌููุนุฉ' : 'ุฅูุดุงุก ูุฌููุนุฉ' }}
    </h3>

    <input type="text" [(ngModel)]="clubForm.name"
           placeholder="ุงุณู ุงููุฌููุนุฉ"
           class="border p-2 mb-3 w-full rounded focus:outline-[#7F55E0]" />

    <textarea [(ngModel)]="clubForm.description"
              placeholder="ุงููุตู"
              class="border p-2 w-full rounded focus:outline-[#7F55E0] mb-3"></textarea>

    <div class="flex justify-end gap-3 mt-4">
      <button class="bg-gray-400 text-white px-4 py-2 rounded"
              (click)="closeClubModal()">ุฅูุบุงุก</button>
      <button class="bg-[#7F55E0] text-white px-4 py-2 rounded"
              (click)="saveClub()">ุญูุธ</button>
    </div>
  </div>
</div>

<!-- ูุงูุฐุฉ ุงูุญุฐู -->
<div *ngIf="showDeleteModal"
     class="fixed inset-0 bg-black bg-opacity-30 flex justify-center items-center p-4" dir="rtl">
  <div class="bg-white p-6 rounded-lg w-full max-w-md text-center">
    <p class="text-lg mb-4">
      ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุญุฐู <span class="font-semibold">{{ selectedClub?.name }}</span>ุ
    </p>
    <div class="flex justify-center gap-3">
      <button class="bg-gray-400 text-white px-4 py-2 rounded"
              (click)="closeDeleteModal()">ุฅูุบุงุก</button>
      <button class="bg-red-600 text-white px-4 py-2 rounded"
              (click)="deleteClub()">ุญุฐู</button>
    </div>
  </div>
</div>

<!-- ูุงูุฐุฉ ุงูุฃุนุถุงุก -->
<!-- ูุงูุฐุฉ ุงูุฃุนุถุงุก -->
<div *ngIf="showMembersModal"
     class="fixed inset-0 bg-black bg-opacity-30 flex justify-center items-center p-4" dir="rtl">
  <div class="bg-white p-6 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto">
    <h3 class="text-lg font-semibold mb-4">
      ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก ูู <span class="font-semibold">{{ selectedClub?.name }}</span>
    </h3>

    <!-- ๐ ุงูุจุญุซ ุนู ุทุงูุจ ูุฅุถุงูุชู -->
    <div class="mb-4">
      <input type="text" [(ngModel)]="studentSearch" (input)="searchStudents()"
             placeholder="๐ ุงูุจุญุซ ุนู ุทุงูุจ..." class="border p-2 rounded w-full" />
    </div>

    <!-- ๐ ูุชุงุฆุฌ ุงูุจุญุซ -->
    <div *ngIf="filteredStudents.length > 0" class="mb-4">
      <h4 class="font-semibold mb-2 text-[#2C2F66]">ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ:</h4>
      <div *ngFor="let student of filteredStudents" class="flex justify-between items-center bg-gray-100 rounded p-2 mb-2">
        <span>{{ student.user.name }}</span>
        <button (click)="addMember(student.id)" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
          โ ุฅุถุงูุฉ
        </button>
      </div>
    </div>

    <!-- โ ุงูุฃุนุถุงุก ุงูููุงูู ุนูููู -->
<div class="mt-6">
  <h4 class="font-semibold mb-2 text-[#2C2F66]">ุงูุฃุนุถุงุก ุงูููุงูู ุนูููู:</h4>
  <div *ngIf="clubMembers.length === 0" class="text-sm text-gray-500">ูุง ููุฌุฏ ุฃุนุถุงุก ุญุงููุงู.</div>
  <div *ngFor="let member of clubMembers" class="flex justify-between items-center border-b py-2">
    <span>{{ member.student.user.name }}</span>
    <button (click)="removeMember(member.id)" class="text-red-600 hover:text-red-800 text-sm">๐๏ธ ุญุฐู</button>
  </div>
</div>

<!-- ๐ ุงูุทูุจุงุช ุงููุนููุฉ -->
<div class="mt-6" *ngIf="pendingRequests.length > 0">
  <h4 class="font-semibold mb-2 text-[#2C2F66]">ุงูุทูุจุงุช ุงููุนููุฉ:</h4>
  <div *ngFor="let req of pendingRequests" class="flex justify-between items-center border-b py-2">
    <span>{{ req.student.user.name }}</span>
    <div class="flex gap-2">
      <button (click)="approveRequest(req.id)" class="text-green-600 hover:text-green-800 text-sm">โ๏ธ ูุจูู</button>
      <button (click)="rejectRequest(req.id)" class="text-red-600 hover:text-red-800 text-sm">โ ุฑูุถ</button>
    </div>
  </div>
</div>

<!-- โ ุงูุทูุจุงุช ุงููุฑููุถุฉ -->
<div class="mt-6" *ngIf="rejectedMembers.length > 0">
  <h4 class="font-semibold mb-2 text-[#2C2F66]">ุงููุฑููุถูู:</h4>
  <div *ngFor="let r of rejectedMembers" class="flex justify-between items-center border-b py-2">
    <span>{{ r.student.user.name }}</span>
    <button (click)="removeMember(r.id)" class="text-red-500 hover:text-red-700 text-sm">๐๏ธ ุญุฐู</button>
  </div>
</div>

    <div class="flex justify-end mt-6">
      <button class="bg-[#7F55E0] text-white px-4 py-2 rounded" (click)="closeMembersModal()">ุฅุบูุงู</button>
    </div>
  </div>
</div>
</div>

<!-- Spinner -->
<div *ngIf="loading" class="fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50">
  <div class="w-16 h-16 border-4 border-purple-500 border-dashed rounded-full animate-spin"></div>
</div>
